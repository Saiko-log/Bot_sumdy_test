<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Мое Расписание</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* Простые стили для красивого отображения */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            padding: 10px;
            background-color: var(--tg-theme-bg-color, #ffffff); /* Используем цвета из Telegram */
            color: var(--tg-theme-text-color, #000000);
        }
        .class-card {
            background-color: var(--tg-theme-secondary-bg-color, #f1f1f1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .class-title {
            font-weight: bold;
            font-size: 1.1em;
        }
        .class-time {
            color: var(--tg-theme-hint-color, #777777);
            margin-bottom: 10px;
        }
        .class-details, .class-notes {
            margin-top: 10px;
        }
        textarea, input {
            width: 95%;
            padding: 8px;
            margin-top: 5px;
            border-radius: 5px;
            border: 1px solid var(--tg-theme-hint-color, #cccccc);
        }
        button {
            background-color: var(--tg-theme-button-color, #007bff);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
    </style>
</head>
<body>

    <h1>Мое расписание</h1>
    <div id="schedule-container">
        <p>Загрузка расписания...</p>
    </div>

    <script>
        // Инициализируем Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.ready();

        // Функция для отображения пар (пока это просто пример)
        function renderSchedule(classes) {
            const container = document.getElementById('schedule-container');
            container.innerHTML = ''; // Очищаем контейнер

            if (classes.length === 0) {
                container.innerHTML = '<p>Расписание пусто. Загрузите файл .ics через бота.</p>';
                return;
            }

            classes.forEach(cls => {
                const card = document.createElement('div');
                card.className = 'class-card';

                // Преобразуем дату для красивого отображения
                const startTime = new Date(cls.dtstart).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                const endTime = new Date(cls.dtend).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                const classDate = new Date(cls.dtstart).toLocaleDateString();


                card.innerHTML = `
                    <div class="class-title">${cls.summary || 'Без названия'}</div>
                    <div class="class-time">${classDate} (${startTime} - ${endTime})</div>
                    <div class="class-details">
                        <p><strong>Преподаватель:</strong> ${cls.description ? cls.description.split('\\n')[0] : 'Не указан'}</p>
                    </div>
                    <div class="class-notes">
                        <label for="link-${cls.uid}">Ссылка на лекцию:</label>
                        <input type="url" id="link-${cls.uid}" value="${cls.link || ''}" placeholder="https://zoom.us/...">
                        <label for="notes-${cls.uid}">Мои заметки:</label>
                        <textarea id="notes-${cls.uid}" rows="3" placeholder="Домашнее задание, важные моменты...">${cls.notes || ''}</textarea>
                        <button onclick="saveChanges('${cls.uid}')">Сохранить</button>
                    </div>
                `;
                container.appendChild(card);
            });
        }
        
        // --- Взаимодействие с бэкендом (ВАЖНО!) ---
        // В реальном приложении здесь будет код для получения данных от вашего бота
        // Например, через Fetch API. Для этого бэкенд должен быть веб-сервером (например, на aiohttp или Flask)
        // А пока мы используем "заглушку" с примером данных.
        
        // Пример данных, которые в будущем будет присылать бэкенд
        const exampleData = [
            {
                uid: 'example1',
                summary: 'Программирование (лекция)',
                dtstart: '2025-10-08T15:35:00',
                dtend: '2025-10-08T16:55:00',
                description: 'Горячев Олексій Євгенійович\\nЕС-21',
                link: '',
                notes: 'Подготовиться к контрольной'
            },
            {
                uid: 'example2',
                summary: 'Информационная безопасность (лекция)',
                dtstart: '2025-10-08T14:00:00',
                dtend: '2025-10-08T15:20:00',
                description: 'Єрмаков Максим Сергійович\\nЕС-21',
                link: 'https://example.com/lecture',
                notes: ''
            }
        ];
        
        renderSchedule(exampleData);
        
        function saveChanges(uid) {
            const link = document.getElementById(`link-${uid}`).value;
            const notes = document.getElementById(`notes-${uid}`).value;
            
            // Здесь будет код отправки данных на бэкенд
            console.log(`Сохраняем для ${uid}:`, { link, notes });
            
            // Показываем уведомление об успехе
            tg.showPopup({
                title: 'Сохранено!',
                message: 'Ваши заметки и ссылка были успешно обновлены.',
                buttons: [{type: 'ok'}]
            });
        }
    </script>
</body>
</html>